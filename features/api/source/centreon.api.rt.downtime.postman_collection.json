{
  "info": {
    "name": "Realtime downtime",
    "_postman_id": "5abbabe3056e2",
    "description": "Realtime downtime",
    "schema": "https:\/\/schema.getpostman.com\/json\/collection\/v2.1.0\/collection.json"
  },
  "item": [{
    "name": "Addhost Realtime",
    "event": [{
      "listen": "prerequest",
      "script": {
        "type": "text\/javascript",
        "exec": ["postman.setGlobalVariable(\"fixed\", \"1\");",
          "",
          "var date = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"Europe/Paris\"}));",
          "var datetime_start = date.getFullYear() + \"\/\" + ('0' + (date.getMonth()+1)).slice(-2) + \"\/\" + ('0' + date.getDate()).slice(-2) + \" \" + ('0' + date.getHours()).slice(-2) + \":\" + ",
          "('0' + date.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"start_time\", datetime_start);",
          "",
          "var dateEnd = new Date(date.setHours(date.getHours()+2));",
          "var datetime_end = dateEnd.getFullYear() + \"\/\" + ('0' + (dateEnd.getMonth()+1)).slice(-2) + \"\/\" + ('0' + dateEnd.getDate()).slice(-2) + \" \" + ('0' + dateEnd.getHours()).slice(-2) + \":\" + ",
          "('0' + dateEnd.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"end_time\", datetime_end);",
          ""]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"HOST;{{host_name}};{{start_time}};{{end_time}};1;3600;Ceci est un commentaire;0\"\n}\n"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "equals": true,
          "key": "action",
          "value": "action"
        }, {
          "equals": true,
          "key": "object",
          "value": "centreon_clapi"
        }]
      }
    },
    "response": []
  }, {
    "name": "Addservice Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }, {
      "listen": "prerequest",
      "script": {
        "type": "text\/javascript",
        "exec": ["postman.setGlobalVariable(\"fixed\", \"1\");",
          "", "var date = new Date(new Date().toLocaleString(\"en-US\", {timeZone: \"Europe/Paris\"}));",
          "var datetime_start = date.getFullYear() + \"\/\" + ('0' + (date.getMonth()+1)).slice(-2) + \"\/\" + ('0' + date.getDate()).slice(-2) + \" \" + ('0' + date.getHours()).slice(-2) + \":\" + ",
          "('0' + date.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"start_time\", datetime_start);",
          "", "var dateEnd = new Date(date.setHours(date.getHours()+2));",
          "var datetime_end = dateEnd.getFullYear() + \"\/\" + ('0' + (dateEnd.getMonth()+1)).slice(-2) + \"\/\" + ('0' + dateEnd.getDate()).slice(-2) + \" \" + ('0' + dateEnd.getHours()).slice(-2) + \":\" + ",
          "('0' + dateEnd.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"end_time\", datetime_end);", ""]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"SVC;{{host_name}},{{service_description}};{{start_time}};{{end_time}};1;3600;Ceci est un commentaire;\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "equals": true,
          "key": "action",
          "value": "action"
        }, {
          "equals": true,
          "key": "object",
          "value": "centreon_clapi"
        }]
      }
    },
    "response": []
  }, {
    "name": "Addhostgroup Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }, {
      "listen": "prerequest",
      "script": {
        "type": "text\/javascript",
        "exec": ["postman.setGlobalVariable(\"fixed\", \"1\");",
          "",
          "var date = new Date();",
          "var datetime_start = date.getFullYear() + \"\/\" + ('0' + (date.getMonth()+1)).slice(-2) + \"\/\" + ('0' + date.getDate()).slice(-2) + \" \" + ('0' + date.getHours()).slice(-2) + \":\" + ",
          "('0' + date.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"start_time\", datetime_start);",
          "",
          "var dateEnd = new Date(date.setHours(date.getHours()+2));",
          "var datetime_end = dateEnd.getFullYear() + \"\/\" + ('0' + (dateEnd.getMonth()+1)).slice(-2) + \"\/\" + ('0' + dateEnd.getDate()).slice(-2) + \" \" + ('0' + dateEnd.getHours()).slice(-2) + \":\" + ",
          "('0' + dateEnd.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"end_time\", datetime_end);"]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"HG;{{hg_name}};{{start_time}};{{end_time}};1;3600;Ceci est un commentaire;0\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "equals": true,
          "key": "action",
          "value": "action"
        }, {
          "equals": true,
          "key": "object",
          "value": "centreon_clapi"
        }]
      }
    },
    "response": []
  }, {
    "name": "Addservicegroup Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;"]
      }
    }, {
      "listen": "prerequest",
      "script": {
        "type": "text\/javascript",
        "exec": ["postman.setGlobalVariable(\"fixed\", \"1\");",
          "", "var date = new Date();",
          "var datetime_start = date.getFullYear() + \"\/\" + ('0' + (date.getMonth()+1)).slice(-2) + \"\/\" + ('0' + date.getDate()).slice(-2) + \" \" + ('0' + date.getHours()).slice(-2) + \":\" + ",
          "('0' + date.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"start_time\", datetime_start);",
          "",
          "var dateEnd = new Date(date.setHours(date.getHours()+2));", "var datetime_end = dateEnd.getFullYear() + \"\/\" + ('0' + (dateEnd.getMonth()+1)).slice(-2) + \"\/\" + ('0' + dateEnd.getDate()).slice(-2) + \" \" + ('0' + dateEnd.getHours()).slice(-2) + \":\" + ",
          "('0' + dateEnd.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"end_time\", datetime_end);"]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"SG;{{sg_name}};{{start_time}};{{end_time}};1;3600;Ceci est un commentaire;\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "equals": true,
          "key": "action",
          "value": "action"
        }, {
          "equals": true,
          "key": "object",
          "value": "centreon_clapi"
        }]
      }
    },
    "response": []
  }, {
    "name": "Addinstance Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;",
          "",
          "function wait(millis) {", "  var date = new Date();",
          "  var curDate = null;",
          "  do { curDate = new Date(); }",
          "  while(curDate-date < millis);",
          "}",
          "",
          "wait(5000);"]
      }
    }, {
      "listen": "prerequest",
      "script": {
        "type": "text\/javascript",
        "exec": ["postman.setGlobalVariable(\"fixed\", \"1\");",
          "",
          "var date = new Date();",
          "var datetime_start = date.getFullYear() + \"\/\" + ('0' + (date.getMonth()+1)).slice(-2) + \"\/\" + ('0' + date.getDate()).slice(-2) + \" \" + ('0' + date.getHours()).slice(-2) + \":\" + ",
          "('0' + date.getMinutes()).slice(-2);",
          "postman.setEnvironmentVariable(\"start_time\", datetime_start);",
          "",
          "var dateEnd = new Date(date.setHours(date.getHours()+2));",
          "var datetime_end = dateEnd.getFullYear() + \"\/\" + ('0' + (dateEnd.getMonth()+1)).slice(-2) + \"\/\" + ('0' + dateEnd.getDate()).slice(-2) + \" \" + ('0' + dateEnd.getHours()).slice(-2) + \":\" + ",
          "('0' + dateEnd.getMinutes()).slice(-2);", "postman.setEnvironmentVariable(\"end_time\", datetime_end);"]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"add\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"INSTANCE;Central;{{start_time}};{{end_time}};1;3600;Ceci est un commentaire;\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true
        }]
      }
    },
    "response": []
  }, {
    "name": "Show Service Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;",
          "var contentType = postman.getResponseHeader(\"Content-Type\");",
          "tests[\"Content-Type is application\/json\"] = contentType === \"application\/json\";",
          "",
          "var jsonData = JSON.parse(responseBody);",
          "var result = jsonData.result;",
          "",
          "var schema = {",
          "    \"type\": \"array\",",
          "    \"items\": {",
          "        \"type\": \"object\",",
          "        \"properties\": {",
          "            \"id\": {\"type\": \"string\" },",
          "            \"host_name\": {\"type\": \"string\" },",
          "            \"service_name\": {\"type\": \"string\" },",
          "            \"author\": { \"type\": \"string\" },",
          "            \"actual_start_time\": { \"type\": \"string\" },",
          "            \"actual_end_time\": { \"type\": \"string\"},",
          "            \"start_time\": { \"type\": \"string\"},",
          "            \"end_time\": {\"type\": \"string\"},",
          "            \"comment_data\": {\"type\": \"string\" },",
          "            \"duration\": {\"type\": \"string\" },",
          "            \"fixed\": { \"type\": \"string\"},",
          "            \"url\": { \"type\": \"string\" }",
          "        },",
          "        \"additionalProperties\": false,",
          "        \"required\": [\"id\", \"host_name\", \"service_name\", \"author\", \"actual_start_time\", \"actual_end_time\", \"start_time\", \"end_time\", \"comment_data\", \"duration\", \"fixed\", \"url\"]",
          "    }",
          "}",
          "",
          "tests[\"Validate schema JSON\"] = tv4.validate(result, schema);"]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"show\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"SVC;{{host_name}},{{service_description}}\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true
        }]
      }
    },
    "response": []
  }, {
    "name": "Show Host Realtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;",
          "var contentType = postman.getResponseHeader(\"Content-Type\");",
          "tests[\"Content-Type is application\/json\"] = contentType === \"application\/json\";",
          "", "var jsonData = JSON.parse(responseBody);",
          "var result = jsonData.result;",
          "",
          "var schema = {",
          "    \"type\": \"array\",",
          "    \"items\": {",
          "        \"type\": \"object\",",
          "        \"properties\": {",
          "            \"id\": {\"type\": \"string\" },",
          "            \"host_name\": {\"type\": \"string\"},",
          "            \"author\": {\"type\": \"string\" },",
          "            \"actual_start_time\": {\"type\": \"string\" },",
          "            \"actual_end_time\": {\"type\": \"string\"},",
          "            \"start_time\": { \"type\": \"string\"},",
          "            \"end_time\": { \"type\": \"string\"},",
          "            \"comment_data\": {\"type\": \"string\" },",
          "            \"duration\": {\"type\": \"string\" },",
          "            \"fixed\": {\"type\": \"string\" },",
          "            \"url\": {\"type\": \"string\"}",
          "        },", "        \"additionalProperties\": false,",
          "        \"required\": [\"id\", \"host_name\", \"author\", \"actual_start_time\", \"actual_end_time\", \"start_time\", \"end_time\", \"comment_data\", \"duration\", \"fixed\", \"url\"]",
          "    }",
          "}",
          "",
          "postman.setEnvironmentVariable(\"rtdowntime_id\",result[0].id);",
          "",
          "tests[\"Validate schema JSON\"] = tv4.validate(result, schema);",
          ""]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "Content-Type",
        "value": "application\/json"
      }, {
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"show\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"HOST;{{host_name}}\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true
        }]
      }
    },
    "response": []
  }, {
    "name": "Cancel downtime",
    "event": [{
      "listen": "test",
      "script": {
        "type": "text\/javascript",
        "exec": ["tests[\"Status code is 200\"] = responseCode.code === 200;",
          "var contentType = postman.getResponseHeader(\"Content-Type\");",
          "tests[\"Content-Type is application\/json\"] = contentType === \"application\/json\";", ""]
      }
    }],
    "request": {
      "method": "POST",
      "header": [{
        "key": "centreon-auth-token",
        "value": "{{token}}"
      }, {
        "key": "Content-Type",
        "value": "application\/json"
      }],
      "body": {
        "mode": "raw",
        "raw": "{\n  \"action\": \"CANCEL\",\n  \"object\": \"RTDOWNTIME\",\n  \"values\": \"{{rtdowntime_id}}\"\n}"
      },
      "url": {
        "raw": "http:\/\/{{url}}\/centreon\/api\/index.php?action=action&object=centreon_clapi",
        "protocol": "http",
        "host": ["{{url}}"],
        "path": ["centreon", "api", "index.php"],
        "query": [{
          "key": "action",
          "value": "action",
          "equals": true
        }, {
          "key": "object",
          "value": "centreon_clapi",
          "equals": true
        }]
      }
    },
    "response": []
  }]
}